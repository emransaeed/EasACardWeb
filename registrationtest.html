<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <title>EasACard</title>
</head>
<body>

    <div>
        <h2>All Customers</h2>
        <ul id="Customers" />
    </div>
    <div>
        <h2>Search by ID</h2>
        <input type="text" id="userId" size="5" />
        <input type="button" value="Search" onclick="getCustomer();" />
        <p id="customer" />
    </div>

    <div>
        <h2>Register Individual</h2>
        <input type="button" value="Register" onclick="registerIndividual();" />
        <p id="register" />
    </div>

    <div>
        <h2>Register Company</h2>
        <input type="button" value="Register" onclick="registerCompany();" />
        <p id="register" />
    </div>

    <div>
        <h2>Login Individual</h2>
        <input type="text" id="username" size="50" /><br />
        <input type="text" id="password" size="50" />
        <input type="button" value="Login" onclick="loginIndividual();" />
        <p id="account" />
    </div>

    <div>
        <h2>Login Company</h2>
        <input type="text" id="username1" size="50" /><br />
        <input type="text" id="password1" size="50" />
        <input type="button" value="Login" onclick="loginCompany();" />
        <p id="account1" />
    </div>

    <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-2.0.3.min.js"></script>
    <script>
        var urlGetAllCustomers = 'http://localhost:51664/Customer/GetAllCustomers';
        var urlGetCustomer = 'http://localhost:51664/Customer/GetCustomer?userId={id}';
        var urlRegisterIndividual = 'http://localhost:51664/Customer/RegisterIndividual';
        var urlRegisterCompany = 'http://localhost:51664/Customer/RegisterCompany';
        var urlLoginIndividual = 'http://localhost:51664/Customer/LoginIndividual?username={username}&password={password}';
        var urlLoginCompany = 'http://localhost:51664/Customer/LoginCompany?username={username}&password={password}';

        $(document).ready(getAllCustomers);

        function formatItem(item) {
            return item.Name + ': ' + item.UserID;
        }

        function getAllCustomers() {
            $.ajax({
                url: urlGetAllCustomers,
                dataType: 'jsonp',
                success: function (data) {
                    $.each(data, function (key, item) {
                        $('<li>', { text: formatItem(item) }).appendTo($('#Customers'));
                    }
                    );
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    $('#customer').text('Error:' + thrownError + ' ' + ajaxOptions + ' ' + xhr.status + ' ' + xhr.readyState);
                }
            });
        }

        function getCustomer() {
            var id = $('#userId').val();

            $.ajax({
                url: urlGetCustomer.replace('{id}', id),
                dataType: 'jsonp',
                success: function (data) {
                    if (data != null)
                    {
                        $('#customer').text(formatItem(data));
                    }
                    else
                    {
                        $('#customer').text('Customer does not exist.');
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    $('#customer').text('Error:' + thrownError + ' ' + ajaxOptions + ' ' + xhr.status + ' ' + xhr.readyState);
                }
            });
        }

        function registerIndividual() {
            jQuery.support.cors = true;
            var customer = {
                UserID: '1',
                UserName: 'u1',
                Email: 'test@test.com',
                Password: 'psw',
                Country: 'PK',
                Phone: '01234',
                Name: 'abc',
                VerificationCode:'v'
            };

            $.ajax({
                url: urlRegisterIndividual,
                data: customer,
                type: 'POST',
                dataType: 'json',
                success: function () {
                    $('#register').text("Registered");
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    $('#register').text('thrownError: ' + thrownError + ' ajaxOptions:' + ajaxOptions + ' status:' + xhr.status + ' readyState:' + xhr.readyState);
                }
            });
        }

        function registerCompany() {
            jQuery.support.cors = true;
            var customer = {
                CompanyID:'1',
                UserName: 'u1',
                Email: 'test@test.com',
                Password: 'psw',
                Country: 'PK',
                Phone: '01234',
                Name: 'c1',
                ContactPerson: 'cp1',
                Mobile: '01234',
                Address: 'add',
                City: 'Sydney',
                VerificationCode: 'v'
            };

            $.ajax({
                url: urlRegisterCompany,
                data: customer,
                type: 'POST',
                dataType: 'json',
                success: function () {
                    $('#register').text("Registered");
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    $('#register').text('thrownError: ' + thrownError + ' ajaxOptions:' + ajaxOptions + ' status:' + xhr.status + ' readyState:' + xhr.readyState);
                }
            });
        }

        function loginIndividual() {
            var username = $('#username').val();
            var password = $('#password').val();

            $.ajax({
                url: urlLoginIndividual.replace('{username}', username).replace('{password}', password),
                dataType: 'jsonp',
                success: function (data) {
                    if (data != null) {
                        $('#account').text(data.UserID + ' ' + data.ExpiryDate);
                    }
                    else {
                        $('#account').text('Account does not exist.');
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    $('#account').text('Error:' + thrownError + ' ' + ajaxOptions + ' ' + xhr.status + ' ' + xhr.readyState);
                }
            });
        }

        function loginCompany() {
            var username = $('#username1').val();
            var password = $('#password1').val();

            $.ajax({
                url: urlLoginCompany.replace('{username}', username).replace('{password}', password),
                dataType: 'jsonp',
                success: function (data) {
                    if (data != null) {
                        $('#account1').text(data.CompanyID + ' ' + data.ExpiryDate);
                    }
                    else {
                        $('#account1').text('Account does not exist.');
                    }
                },
                error: function (xhr, ajaxOptions, thrownError) {
                    $('#account1').text('Error:' + thrownError + ' ' + ajaxOptions + ' ' + xhr.status + ' ' + xhr.readyState);
                }
            });
        }
    </script>
</body>
</html>